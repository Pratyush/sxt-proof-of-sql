// SPDX-License-Identifier: UNLICENSED
// This is licensed under the Cryptographic Open Software License 1.0
pragma solidity ^0.8.28;

import {Test} from "forge-std/Test.sol";
import "./../../src/base/Constants.sol";
import {Errors} from "./../../src/base/Errors.sol";
import {Verifier} from "./../../src/verifier/Verifier.pre.sol";

contract VerifierTest is Test {
    function verify(
        bytes calldata result,
        bytes calldata plan,
        uint256[] calldata placeholderParameters,
        bytes calldata proof,
        uint256[] memory tableLengths,
        uint256[] memory commitments
    ) public view {
        Verifier.__verify({
            __result: result,
            __plan: plan,
            __placeholderParameters: placeholderParameters,
            __proof: proof,
            __tableLengths: tableLengths,
            __commitments: commitments
        });
    }

    function testSimpleFull() public view {
        uint256[] memory tableLengths = new uint256[](1);
        tableLengths[0] = 6;
        uint256[] memory commitments = new uint256[](4);
        commitments[0] = 10330259091102222580680469239495014349163118537637164875615751892418606990939;
        commitments[1] = 11920476268597659993223945595713248355766624440856258163660132291159882440306;
        commitments[2] = 11994260765248910561540716452031502208136256599213361935879450273410509855704;
        commitments[3] = 13760418268827664034425846360177624835399216842325030254024970295997593510876;
        uint256[] memory placeholderParameters = new uint256[](0);
        Verifier.__verify({
            __result: hex"00000000000000010000000000000001620000000005000000000000000200000000000000000000000000000003",
            __plan: hex"0000000000000001000000000000000f6e616d6573706163652e7461626c650000000000000002000000000000000000000000000000016200000005000000000000000000000000000000016100000005000000000000000100000000000000016200000000000000000000000000000002000000000000000000000001000000010000000500000000000000050000000000000001000000000000000000000000",
            __placeholderParameters: placeholderParameters,
            __proof: hex"000000000000000600000000000000020000000000000001000000000000000200000000000000000000000000000001236cd1dd5ae57dd08a8b09bd6bd3397fe4b58aa1638c554b8054dcb2d4d0297e12a7e3d2a6d11cf4e66979ea5458d24f66ba7866c43b933fd2135c2a761990140000000000000006000000000000000427a607595971e4f8531109d6bcf114838faac36652aa81d86d51f087cd08799c1095fa761ceaceb796068f4b8174492ede1e88c2f4aafee493331c267284be330078dfd5227feba93faa9a0c9c38432d6c169909d2546f8cef0b7a2108d44db71d518c19207b5ee92cca5cfe09ec5aca67af638b4205a7b650ccb9b9ecd6dd812bbc76361bfaf1e75d70512e9911c71b134404cecbce4053e29ec7c0067717941b11c59c7ba544571e02ba430f9256a63b51e7c8927ffd0d9763fc59bcdcad9521defadf9d440192285b6a0f4e7dc657225821e39bca44e618f7331859e431a62921dd8f70e56f4b52a667f4a851eef537584fb196d14cde47a607f2f6015f3c0000000000000000000000000000000c08a4646bbe5bcbd84f70d57e4199feea96727b0891cd7fc2b9c4548c79134fdc3056f9d01ed8ac370d2d91499df82105cc5842626884827bbd5da23bde9d9f2f27cd3ea9e52ec844140224a5237090c9ed9d1325f920dee410a1f45f884f10f700000000000000000000000000000000000000000000000000000000000000000cb3c1f4236d067d2121b1970bba959f6eb34a5dc55780360adf721cb7706d841e3a39b44aa419741fae45991ff853985acb44d6da117591f5c62bdcd34efa5e0cad3ebe8e7c85e28b999e7e98891b7f5de8dfeb641816693ff4c88ccd378bb10f76ac6934ab963d8cf2de36d5082457f1d4f37b399bab85a7a3e0748b98f4481f5fbcd1225d6fc2179d67784f8cc33f96af63fd2bc3bc0a0b24a2aef032f4e003ede74206e0c0224fbe9c670c28a6a8523bbb853df530b7e8d210d41fa1eeb20567b8ab1dd1ac6b76c90f55380a0e9f6ae397f9f2b29cdd9ed166243e6637591ac21cb2b3d1ed5ae89915fb2dfff88f8d86565b98cf106ed13c21abd2a0d86800000000000000012ab9aab80d43f7435784460a9a510611d5ea4cddb88ea32ccc3c7ca747b95c9d000000000000000216939642c7e9031cbb6e8dc903683c563fe29ffee7344b7c1705ecfb08c627b22f0a59c8d49c3b5d84f2e6e73cf44f2c05005ccf6f4b644e26399fa59e3eab2000000000000000041e837176dd46439a98b5e1aad2c2be57a9cec6c0a6e949e325681657fc59201824588a6ca09cd690acfac8a388cd7c2c2b2105cef96856365a2809a051aaaf231b7e9025b83e0435c1d7f5a8f42da0c4d0809a2b89df0792574778003419af3e2b59a06fd0744f42d07b57f7d8cda7a2032b86fc9eeaf80e4f858faa0e1da9ee00000000000000021cc3fcf38084a75d2d2e8f65edd2e7f1c98e27936ed4ec9c2f83d7d7f953d48d2276ff007d3bda222501c2f5b5ef10b7bf69d177de3ae102dc6e95507b7db4620d6089448b955000aec99031b580405143cd992004d92d0bb840748ad17cce2808947359cf839bc2792b71bb653862169475ccf7d354f0e05ff44b9600fb97500000000000000003120eef7fd4b3ee1684781b3828b14e5ce92a348993e090ef7aefed628428f04111c60d0bb82ab6223350ef46a99b6aaf72d9d10a090dc84c1b4dd1719f6d047829729324a31c3bcf393b4fa25704e2104cfd60e68e43f68892f8b69292efea7202e33bf988181994edcd6d7663b5590339d28e0509d8c0fc0d93334298e1295d12401b7ec5e8363c4ff0d04d7a20ff9584798bf571d5f5ea6a18ac08511742d229d4fa347951ed2d4812b378ac25dc7f278efea58239686edd309c65d1254b20238a63c8139c66b11f73e4490c47bd54517e9a3d84e7e1728bd2545c50070b8f2a5d10f0f8dc22249e979d95b4d5cbede923f576993884fc468d5a675bd7e4f02ae68ad8a170536483d1c64ad7763ee693cb2f963577bd6e530a275337a3480e2eefe01b65c73902b1bd918c0320fa626052596cdd8a43c1be1904df048ca02e16a1c960daf465f7578155147ee1ccf23aff18f620a299a539b3341a5bde26f80ef8f2d1a2febc7c56bf170a18a3215cdc2d2861002a582b7ff03c5c2ceceaf52f21e226bb2d43a1cfc1daee7dad66c1be678f2bb55ec1fc312916b58a240a980687fda634e438a343b885bc944199728f2161d6a244e06ac84a4cdbafdcb6d60e62f98d94384fa7bc869e213dce126be5d98e3b72241f7a615fa4f301d6af09",
            __tableLengths: tableLengths,
            __commitments: commitments
        });
    }

    function testCommitmentArrayOddLength() public {
        uint256[] memory tableLengths = new uint256[](1);
        tableLengths[0] = 6;

        // Create an array with an odd length (5 elements)
        uint256[] memory commitments = new uint256[](5);
        commitments[0] = 10330259091102222580680469239495014349163118537637164875615751892418606990939;
        commitments[1] = 11920476268597659993223945595713248355766624440856258163660132291159882440306;
        commitments[2] = 11994260765248910561540716452031502208136256599213361935879450273410509855704;
        commitments[3] = 13760418268827664034425846360177624835399216842325030254024970295997593510876;
        commitments[4] = 12345678901234567890123456789012345678901234567890123456789012345678901234567; // Add extra element

        uint256[] memory placeholderParameters = new uint256[](0);

        // Expect the error for odd-length commitment array
        vm.expectRevert(Errors.CommitmentArrayOddLength.selector);

        Verifier.__verify({
            __result: hex"00",
            __plan: hex"00",
            __placeholderParameters: placeholderParameters,
            __proof: hex"00",
            __tableLengths: tableLengths,
            __commitments: commitments
        });
    }
}
